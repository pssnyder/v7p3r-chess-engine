# V7P3R v14.1 Manual VM Deployment Guide

**Date**: November 6, 2025  
**Deployment**: v14.0 ‚Üí v14.1 (Smart Time Management Build)

---

## üéØ Quick Deployment Steps

### **Option A: Automated Script (Recommended)**

```bash
# On your local machine
cd "s:/Maker Stuff/Programming/Chess Engines/Deployed Engines/v7p3r-lichess-engine"
chmod +x update-to-v14.1.sh
./update-to-v14.1.sh

# Then follow the prompts
```

---

### **Option B: Manual VM Deployment (Step-by-Step)**

#### **1. Prepare Files Locally**

```bash
# Verify v14.1 is ready
cd "s:/Maker Stuff/Programming/Chess Engines/Deployed Engines/v7p3r-lichess-engine"
ls -la engines/V7P3R_v14.1/src/

# Should see:
# - v7p3r.py (v14.1 engine core)
# - v7p3r_uci.py (v14.1 UCI interface)
# - v7p3r_bitboard_evaluator.py
```

#### **2. Copy Files to VM**

**Using SCP:**
```bash
# Set your VM IP
VM_IP="YOUR_VM_IP_HERE"
VM_USER="YOUR_USERNAME"

# Copy engine files
scp -r engines/V7P3R_v14.1/src/ $VM_USER@$VM_IP:~/lichess-bot/engines/v7p3r/

# Copy updated config
scp config-docker-cloud.yml $VM_USER@$VM_IP:~/lichess-bot/config.yml
```

**Using gcloud (if using GCP):**
```bash
# Set your GCP instance name
INSTANCE_NAME="v7p3r-lichess-bot"
ZONE="us-central1-a"

# Copy engine files
gcloud compute scp --recurse engines/V7P3R_v14.1/src/ $INSTANCE_NAME:~/lichess-bot/engines/v7p3r/ --zone=$ZONE

# Copy config
gcloud compute scp config-docker-cloud.yml $INSTANCE_NAME:~/lichess-bot/config.yml --zone=$ZONE
```

#### **3. SSH to VM and Deploy**

```bash
# SSH to VM
ssh $VM_USER@$VM_IP
# OR: gcloud compute ssh $INSTANCE_NAME --zone=$ZONE

# Navigate to bot directory
cd ~/lichess-bot

# Verify files copied correctly
ls -la engines/v7p3r/src/
head -n 20 engines/v7p3r/src/v7p3r.py  # Should show "v14.1"

# Stop current bot
docker-compose down

# Rebuild with new engine
docker-compose build

# Start bot with new engine
docker-compose up -d

# Monitor logs
docker-compose logs -f
```

#### **4. Verify Deployment**

```bash
# Check bot is running
docker-compose ps

# Check logs for v14.1 version
docker-compose logs | grep "V7P3R v14.1"

# Check lichess profile
# Visit: https://lichess.org/@/v7p3r_bot
# Should show "Online" status

# Watch for first game
docker-compose logs -f | grep "info depth"
```

---

## üîç Verification Checklist

After deployment, verify:

- [ ] Bot shows as "Online" on Lichess
- [ ] Engine version shows "V7P3R v14.1" in logs
- [ ] Opening moves are faster (<5s typically)
- [ ] No moves exceed 60 seconds
- [ ] Chess960 challenges are being accepted
- [ ] Time management is smooth (no timeouts)

---

## üìä Expected Behavior Changes

### **Time Management**

| Game Phase | Old (v14.0) | New (v14.1) | Change |
|------------|-------------|-------------|--------|
| Opening (moves 1-8) | ~3-4s | ~1.5-2s | 50% faster |
| Opening (moves 8-15) | ~4-5s | ~2-3s | 40% faster |
| Middlegame (25-40) | ~7-10s | ~5-8s | Slightly faster |
| Endgame (40+) | ~6-8s | ~4-6s | More efficient |
| **Max per move** | Could exceed 60s | **Hard 60s cap** | Safety added |

### **New Features**
- ‚úÖ Chess960 support enabled
- ‚úÖ Classical time controls (up to 90min)
- ‚úÖ Increment-aware time management
- ‚úÖ Smart early return from stable positions

---

## üêõ Troubleshooting

### **Bot won't start**

```bash
# Check Docker logs
docker-compose logs

# Common issues:
# 1. Python syntax error - check engine files copied correctly
# 2. Config error - verify config.yml format
# 3. Port conflict - check if another bot is running
```

### **Bot times out in games**

```bash
# This should NOT happen with v14.1
# If it does, check logs:
docker-compose logs | grep "time"

# Verify v14.1 is actually running:
docker-compose logs | head -50 | grep "V7P3R"
```

### **Engine not making moves**

```bash
# Check UCI communication
docker-compose logs | grep "uci"

# Verify Python engine can run
docker-compose exec bot python3 engines/v7p3r/src/v7p3r_uci.py
# (Type 'uci' then 'quit')
```

### **Chess960 games not being accepted**

```bash
# Verify config has chess960 enabled
docker-compose exec bot cat config.yml | grep "chess960"

# Should see:
#   variants:
#     - standard
#     - chess960
```

---

## üîÑ Rollback Procedure

If v14.1 has issues:

```bash
# SSH to VM
cd ~/lichess-bot

# Stop bot
docker-compose down

# Restore v14.0 from backup
# (Backup was created by update script)
tar -xzf engines/backups/v7p3r_v14.0_backup_*.tar.gz -C engines/v7p3r/

# Update config back to v14.0
sed -i 's/V7P3R v14\.1/V7P3R v14.0/g' config.yml

# Restart
docker-compose up -d

# Monitor
docker-compose logs -f
```

---

## üìà Monitoring After Deployment

### **First 24 Hours**

Monitor these metrics:

1. **Games completed**: Should be playing normally
2. **Time usage**: Opening moves should be faster
3. **Time losses**: Should be ZERO (60s cap prevents this)
4. **Win rate**: Should maintain or improve vs v14.0
5. **Chess960 games**: Check if any are being played

### **Monitoring Commands**

```bash
# Watch real-time logs
docker-compose logs -f

# Check recent games on Lichess
curl -H "Accept: application/x-ndjson" \
  "https://lichess.org/api/games/user/v7p3r_bot?max=10" | \
  jq -r '[.id, .variant, .speed, .status.name] | @tsv'

# Check bot resource usage
docker stats

# Count games played
docker-compose logs | grep "Game Over" | wc -l
```

---

## üéÆ Testing After Deployment

### **Quick Functionality Test**

1. Visit: https://lichess.org/@/v7p3r_bot
2. Click "Challenge to a game"
3. Select: 2+1 Blitz, Rated
4. Play a few moves and observe:
   - Opening moves are fast (< 3s)
   - No moves exceed 60s
   - Bot responds quickly

### **Chess960 Test**

1. Challenge with Chess960 variant
2. Verify bot accepts the challenge
3. Play a game and verify engine handles it correctly

---

## üìû Support

If issues arise:

1. **Check logs first**: `docker-compose logs -f`
2. **Verify version**: Look for "V7P3R v14.1" in logs
3. **Test locally**: Can test on local machine with `./run-docker-local.sh`
4. **Rollback if needed**: Use rollback procedure above

---

## ‚úÖ Success Criteria

Deployment is successful when:

- ‚úÖ Bot is online on Lichess
- ‚úÖ Engine version is v14.1 in logs
- ‚úÖ Opening moves are noticeably faster
- ‚úÖ No time losses in first 50 games
- ‚úÖ Chess960 games are being accepted
- ‚úÖ Overall performance is stable

---

**Deployment prepared**: November 6, 2025  
**Ready for production**: YES ‚úÖ

**Good luck with the deployment! üöÄ**
